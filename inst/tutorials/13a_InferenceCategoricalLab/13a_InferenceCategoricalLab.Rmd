---
title: "Topic 13: Inference for Categorical Data Lab (Part A)"
tutorial:
  id: "InferenceCategoricalLab.Topic13a.AppliedStats"
  version: 1.0
output: 
  learnr::tutorial:
    progressive: TRUE
    allow_skip: TRUE
    
runtime: shiny_prerendered
description: "In this lab, we work with survey data from a 2012 WIN-Gallup poll on the global rise of atheism. The `inference()` function from the `{statsr}` package is introduced. This partial notebook covers the first half of the Topic 13 lab activity. Please use the Part A and Part B versions of the Topic 13 acticity if you are working from a free-tiered Posit Cloud account. Doing so avoids the RAM overflow issue on relaunch that may happen with the full Topic 13 notebook."
---

```{r setup, include=FALSE}
#knitr::opts_chunk$set(eval = FALSE)
#library(tidyverse)
library(ggplot2)
library(dplyr)
library(learnr)
library(gradethis)
library(statsr)

tutorial_options(exercise.timelimit = 60, exercise.checker = gradethis::grade_learnr)

load("www/atheism.RData")
rm(inference)

#knitr::opts_chunk$set(eval = FALSE)
```

## Inference for Categorical Data (Lab)

###

In August of 2012, news outlets ranging from the [Washington Post](http://www.washingtonpost.com/national/on-faith/poll-shows-atheism-on-the-rise-in-the-us/2012/08/13/90020fd6-e57d-11e1-9739-eef99c5fb285_story.html){target="_blank"} to the [Huffington Post](http://www.huffingtonpost.com/2012/08/14/atheism-rise-religiosity-decline-in-america_n_1777031.html){target="_blank"} ran a story about the rise of atheism in America. The source for the story was a poll that asked people, "Irrespective of whether you attend a place of worship or not, would you say you are a religious person, not a religious person or a convinced atheist?" This type of question, which asks people to classify themselves in one way or another, is common in polling and generates categorical data. In this workbook we take a look at the atheism survey and explore what's at play when making inference about population proportions using categorical data.

###

<div id="license">
This is a derivative of a product of OpenIntro that is released under a [Creative Commons Attribution-ShareAlike 3.0 Unported](http://creativecommons.org/licenses/by-sa/3.0){target="_blank"}. The oiginal lab was written for OpenIntro by Andrew Bray and Mine &Ccedil;etinkaya-Rundel.</div>

###

## The survey

You can find the press-release for the WIN-Gallup International poll on the Global Index of Religion and Atheism [here](www/Religiosity_and_Atheism.pdf){target=_"blank"}. Please take a moment to review the report then address the following questions.

```{r questions-report, echo = FALSE}
quiz(
  question_radio(
    "In the first paragraph, several key findings are reported. Do these percentages appear to be *sample statistics* (derived from the data sample) or *population parameters*?",
    answer("sample statistics", correct = TRUE),
    answer("population parameters"),
    answer("There is a mix of both"),
    allow_retry = TRUE,
    random_answer_order = TRUE
  ),
  question_radio(
    "The title of the report is *Global Index of Religiosity and Atheism*. To generalize the report's findings to the global human population, what must we assume about the sampling method?",
    answer("The sample must be random and representative of the global community", correct = TRUE),
    answer("The sample must contain at least 10% of the global population"),
    answer("The sample should include people of all religions, so samples should be taken near a diverse set of places of worship"),
    answer("The survey should be done on the phone to make sure that respondents understand the question being asked"),
    allow_retry = TRUE,
    random_answer_order = TRUE
  ),
  question_radio(
    "Do you expect that the required assumption was satisfied? What are the implications of this?",
    answer("No. The study results can only be extended to countries and regions for which the sample data is representative.", correct = TRUE),
    answer("Yes. The study included a very large number of respondents."),
    answer("Yes. Win-Gallup is a reputable polling organization."),
    answer("No. In order to apply results to the global community the pollsters would need to conduct a census."),
    allow_retry = TRUE,
    random_answer_order = TRUE
  )
)
```

###

Turn your attention to Table 6 (pages 14 and 15) in the Religiosity and Atheism poll documentation, which reports the sample size and response percentages for all 57 countries. While this is a useful format to summarize the data, we will base our analysis on the original data set of individual responses to the survey. These original responses are loaded into this workbook for you in a data frame named `atheism`.

```{r table-v-df-code-block, exercise = TRUE}

```

```{r table-v-df, echo = FALSE}
question_radio(
  "What does each row of Table 6 correspond to? What does each row of `atheism` correspond to?",
  answer("Each row of Table 6 contains the summarized responses by country while each row of `atheism` contains the response of an individual respondent.", correct = TRUE),
  answer("Each row of both Table 6 and the `atheism` data frame contain the response of an individual respondent."),
  answer("Each row of both Table 6 and the `atheism` data frame contain the summarized responses by country."),
  answer("Each row of Table 6 contains the response of an individual respondent while each row of `atheism` contains the summarized responses by country."),
  allow_retry = TRUE,
  random_answer_order = TRUE
)
```

###

To investigate the link between these two ways of organizing this data, take a look at the estimated proportion of atheists in the United States. Towards the bottom of Table 6, we see that this is 5%. We should be able to come to the same number using the `atheism` data.

###

Run the command in the code block below and be sure to understand what the code is doing since you'll be asked to do some similar things later in the workbook. In that code cell, we create a new dataframe called `us12` that contains only the rows in `atheism` associated with respondents to the 2012 survey from the United States. Next, we calculate the proportion of atheist responses. Does it agree with the percentage in Table 6? If not, why?

```{r us-atheism, exercise = TRUE}
us12 <- atheism %>%
  filter(nationality == "United States", 
         year == 2012)

us12 %>%
  count(response) %>%
  mutate(relative_frequency = n / sum(n))
```

## Inference on proportions

###

As you noted previously, Table 6 provides *statistics*, that is, calculations made from the sample of 51,927 people. We'd like insight into the population *parameters* instead. You answer the question, "What proportion of people *in your sample* reported being atheists?" with a sample statistic; while the question "What proportion of people *on Earth* would report being atheists?" is answered with an estimate of the parameter.

###

You'll use what you've learned about inferential tools for estimating population proportions in the previous workbook to answer questions related to the WIN-Gallup poll. Additionally, you'll explore how the value of the population proportion can impact the margin of error for a confidence interval.

###

As long as the conditions for inference are reasonably well satisfied, we can either calculate the standard error and construct the confidence interval by hand or allow the `inference()` function from the `{statsr}` package to do it for us. We note that the `inference()` function is part of the `{statsr}` package for R, which has been installed and loaded for you here.

Run the following code block to construct a confidence interval for the proportion of atheists in the US in 2012.

```{r us-atheism-ci-setup}
us12 <- atheism %>%
  filter(nationality == "United States", 
         year == 2012)
```

```{r us-atheism-ci, exercise = TRUE}
inference(y = response,
          data = us12,
          statistic = "proportion", 
          type = "ci", 
          method = "theoretical", 
          success = "atheist")
```

###

Let's pause for a moment to go through the arguments of this function. The first argument is `y`, which is the response variable that we are interested in: `response`. The next argument, `data` tells the function which data frame to look in and find the `response` column. The `statistic` argument, is the parameter we're interested in: `"proportion"` (other options are `"mean"`, or `"median"`.) Next we decide on the `type` of inference we want: a hypothesis test (`"ht"`) or a confidence interval (`"ci"`). When performing a hypothesis test, we also need to supply the `null` value and `alternative` hypothesis but we're building a confidence interval here so we omit those values -- we can optionally set the `conf_level` parameter but the default is a 95% confidence interval (`conf_level = 0.95`). The `method` parameter chooses the method of inference: `"theoretical"` or `"simulation"` based -- our course is using a theoretical framework, so we will always use that option. Finally, since the goal is to construct an interval estimate for a proportion, it's necessary to specify which level constitutes a "success"; here that is a response of `"atheist"`.

###

Although formal confidence intervals and hypothesis tests don't show up in the WINN-Gallup report, suggestions of inference appear at the bottom of page 6: "In general, the error margin for surveys of this kind is $\pm$ 3-5% at 95% confidence". We will check the validity of this claim later on.

Use the code block below to help you answer the question that follows.

```{r interp-inference-moe-code-block, exercise = TRUE}

```

```{r interp-inference-moe-code-block-hint-1}
#The margin of error is half the width of the 
#confidence interval. You might think of this 
#as the "radius" of the confidence interval.

```

```{r interp-inference-moe, echo = FALSE}
question_radio(
  "Based on the R output, what is the margin of error for the estimate of the proportion of the proportion of atheists in US in 2012?",
  answer("0.0135", correct = TRUE),
  answer("0.0499"),
  answer("0.0069", message = "Oops. The margin of error is the product of the standard error and critical value."),
  answer("0.0364"),
  answer("0.0634"),
  allow_retry = TRUE,
  random_answer_order = TRUE
)
```

###

Using the code block below and your `inference()` function, calculate confidence intervals for the proportion of atheists in 2012 in two other countries of your choice, and report the associated margins of error. Be sure to note whether the conditions for inference are met. It will be helpful to create new data sets for each of the two countries first, and then use these data sets in the `inference()` function to construct the confidence intervals.

```{r use-inference, exercise = TRUE}

```

```{r use-inference-hint-1}
#Revisit the code cell from earlier where we 
#created the us12 data frame.

```

```{r use-inference-hint-2}
#Use similar code to obtain data from a 
#different country, year, or both!

```

```{r use-inference-hint-3}
#Use inference() to build a confidence
#interval for the proportion of atheists
#in your new data frame.

```

## Intermission

We'll stop here and pick back up in *Part B* of this lab activity. As a reminder, the full `Topic 13` notebook is split across this *Part A* notebook and the *Part B* notebook. In *Part B*, you'll investigate the connection between the *population proportion* and the *margin of error* (the portion of the confidence interval corresponding to the product between the *critical value* and the *standard error*. You'll also investigate the *success-failure* condition and the shape of the resulting sampling distribution, specifically in cases where the *success-failure* condition is violated. I'll see you there!

## Submit

```{r context="server"}
learnrhash::encoder_logic(strip_output = TRUE)
```

```{r encode, echo=FALSE}
learnrhash::encoder_ui(
  ui_before = shiny::div(
    "If your instructor is asking you to submit evidence of your completed notebook using a hash code, you may generate that code below. Use the clipboard icon to ensure that you are copying the entire hash."
    )
  )
```

###

<div id="license">
This is lab a derivative of a product of OpenIntro that is released under a [Creative Commons Attribution-ShareAlike 3.0 Unported](http://creativecommons.org/licenses/by-sa/3.0). The oiginal lab was written for OpenIntro by Andrew Bray and Mine &Ccedil;etinkaya-Rundel.</div>
